import{r as s,B as N,S as k,Z as T,V as O,j as n,b as I,e as R}from"./index-Bigs_qPn.js";import{S as z,C as $}from"./index-D38D4kad.js";import{C as E}from"./maximize-2-BRP0ICjq.js";const A=({content:r,isStreaming:t=!1})=>{const[i,d]=s.useState(()=>t),[o,l]=s.useState("idle"),a=s.useRef(!1),x=s.useRef(null),u=s.useRef(null),p=s.useMemo(()=>{const e=String(r||"").toLowerCase().slice(-400);return e?/\b(error|failed|broken|critical|exception|fatal|impossible)\b/.test(e)?"stressed":/\b(unclear|why|where|confused|unknown|\?|search|find|looking|unsure|maybe)\b/.test(e)?"puzzled":/\b(fixing|must|will|going to|implementing|building|planning|step|executing|running)\b/.test(e)?"determined":/\b(success|done|ready|works|resolved|found|correct|ok)\b/.test(e)?"happy":"thinking":"thinking"},[r]),b=s.useMemo(()=>{const e=`w-4 h-4 ${t?"animate-pulse":""}`;switch(p){case"puzzled":return{Icon:z,className:`${e} text-amber-500`};case"stressed":return{Icon:O,className:`${e} text-rose-500`};case"determined":return{Icon:T,className:`${e} text-blue-500`};case"happy":return{Icon:k,className:`${e} text-emerald-500`};case"thinking":default:return{Icon:N,className:`${e} text-indigo-500`}}},[p,t]),f=s.useMemo(()=>{const e=String(r||"").split(/\r?\n/).length,m=String(r||"").length;return{lineCount:e,charCount:m}},[r]),y=s.useMemo(()=>{const e=String(r||"").trim().replace(/\s+/g," ");return e?e.length<=180?e:`${e.slice(0,180)}…`:""},[r]);s.useEffect(()=>{if(t){a.current||d(!0);return}a.current||d(!1)},[t]),s.useEffect(()=>{if(!i||!t)return;const e=x.current;e&&(e.scrollTop=e.scrollHeight)},[r,i,t]),s.useEffect(()=>()=>{u.current&&window.clearTimeout(u.current)},[]);const w=()=>{a.current=!0,d(e=>!e)},j=async e=>{e.preventDefault(),e.stopPropagation();const m=String(r||"");if(!m)return;const h=c=>{l(c),u.current&&window.clearTimeout(u.current),u.current=window.setTimeout(()=>l("idle"),900)};try{await navigator.clipboard.writeText(m),h("copied");return}catch{}try{const c=document.createElement("textarea");c.value=m,c.setAttribute("readonly",""),c.style.position="fixed",c.style.opacity="0",document.body.appendChild(c),c.select();const C=document.execCommand("copy");document.body.removeChild(c),h(C?"copied":"failed")}catch{h("failed")}};if(!r)return null;const{Icon:v}=b;return n.jsxs("div",{className:"mb-4 rounded-2xl border border-border/60 bg-gradient-to-b from-indigo-500/5 to-surface/40 overflow-hidden transition-all duration-200 shadow-sm",children:[n.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-black/5 dark:bg-white/5 hover:bg-black/10 dark:hover:bg-white/10 transition-colors",children:[n.jsxs("button",{type:"button",onClick:w,"aria-expanded":i,className:"flex items-center gap-3 flex-1 text-left",children:[n.jsx("div",{className:"p-1.5 rounded-lg bg-white/60 dark:bg-black/20 border border-border/50 shadow-inner",children:n.jsx(v,{className:b.className})}),n.jsxs("div",{className:"flex flex-col min-w-0",children:[n.jsx("span",{className:"text-[10px] font-bold text-primary/80 uppercase tracking-widest",children:t?"Agent is thinking":"Reasoning Trace"}),n.jsx("span",{className:"text-[10px] text-secondary/70 font-mono truncate",children:t?"streaming…":`${f.lineCount} lines · ${f.charCount} chars`})]}),n.jsx("div",{className:"ml-auto flex items-center gap-2 text-secondary",children:i?n.jsx(E,{size:14}):n.jsx(I,{size:14})})]}),n.jsx("button",{type:"button",onClick:j,className:`shrink-0 p-2 rounded-lg border transition-colors ${o==="copied"?"bg-emerald-500/10 border-emerald-500/30 text-emerald-600":o==="failed"?"bg-rose-500/10 border-rose-500/30 text-rose-600":"bg-white/60 dark:bg-black/20 border-border/50 text-secondary hover:text-primary"}`,title:"Copy thinking","aria-label":"Copy thinking",children:o==="copied"?n.jsx(R,{size:14}):n.jsx($,{size:14})})]}),i?n.jsxs("div",{className:"px-4 py-3 bg-white/50 dark:bg-black/20 border-t border-border/50",children:[n.jsx("div",{ref:x,className:"max-h-[38vh] overflow-y-auto scrollbar-thin pr-1",children:n.jsxs("div",{className:"text-[12px] text-secondary/90 font-mono leading-relaxed whitespace-pre-wrap break-words",children:[r,t&&n.jsx("span",{className:"inline-block w-1.5 h-3 bg-indigo-500 ml-1 animate-pulse"})]})}),!t&&n.jsxs("div",{className:"mt-2 flex justify-between items-center",children:[n.jsxs("div",{className:"text-[9px] text-secondary/70 flex items-center gap-1 opacity-70",children:[n.jsx(k,{size:10})," Thinking is raw and may contain mistakes."]}),n.jsx("div",{className:"text-[9px] text-secondary/50 font-mono",children:p==="happy"?"confident":p==="stressed"?"uncertain":p})]})]}):n.jsx("div",{className:"px-4 py-3 bg-white/30 dark:bg-black/10 border-t border-border/30",children:n.jsx("div",{className:"text-[11px] text-secondary/70 font-mono leading-relaxed line-clamp-2",children:y||"…"})})]})},D=r=>{if(!r)return{thinking:null,content:"",isThinkingOpen:!1};let t=r;const i=t.indexOf("<think>");if(i!==-1){const o=t.indexOf("</think>",i+7);if(o!==-1){const l=t.substring(i+7,o).trim(),a=t.substring(o+8).trim();return{thinking:l,content:g(a),isThinkingOpen:!1}}else{const l=t.substring(i+7).trim(),a=t.substring(0,i).trim();return{thinking:l,content:g(a),isThinkingOpen:!0}}}const d=t.indexOf("<<think>>");if(d!==-1){const o=t.indexOf("<</think>>");if(o!==-1){const l=t.substring(d+9,o).trim(),a=t.substring(o+10).trim();return{thinking:l,content:g(a),isThinkingOpen:!1}}else{const l=t.substring(d+9).trim(),a=t.substring(0,d).trim();return{thinking:l,content:g(a),isThinkingOpen:!0}}}return{thinking:null,content:g(r),isThinkingOpen:!1}};function g(r){return r?r.replace(/<｜tool▁call▁begin｜>/gi,"").replace(/<｜tool▁call▁end｜>/gi,"").replace(/<｜tool▁calls▁begin｜>/gi,"").replace(/<｜tool▁calls▁end｜>/gi,"").replace(/<｜tool▁outputs▁begin｜>/gi,"").replace(/<｜tool▁outputs▁end｜>/gi,"").trim():""}export{A as R,D as p};
